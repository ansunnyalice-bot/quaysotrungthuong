<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>V√≤ng Quay May M·∫Øn Ho·∫°t H√¨nh</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root { --primary: #ff4757; --bg: #f0f2f5; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--bg); display: flex; justify-content: center; padding: 20px; margin: 0; }
        .container { width: 100%; max-width: 900px; background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); text-align: center; }
        
        h1 { color: #333; font-size: 2rem; margin-bottom: 20px; }
        .input-area { background: #fff; padding: 20px; border-radius: 15px; border: 2px dashed #ddd; margin-bottom: 20px; }
        input { padding: 12px; border: 2px solid #eee; border-radius: 10px; outline: none; transition: 0.3s; }
        input:focus { border-color: var(--primary); }
        button { padding: 12px 25px; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; background: #007bff; color: white; transition: 0.3s; }
        button:hover { opacity: 0.9; transform: translateY(-2px); }

        /* Khung hi·ªÉn th·ªã icon */
        #display-area { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); 
            gap: 15px; margin: 30px 0; min-height: 150px; 
        }
        .user-card { 
            background: #fff; border: 2px solid #f0f0f0; padding: 15px; border-radius: 15px; 
            display: flex; flex-direction: column; align-items: center; transition: 0.3s;
        }
        .avatar { width: 60px; height: 60px; margin-bottom: 10px; }
        .user-name { font-weight: bold; color: #555; font-size: 0.9rem; }
        
        /* Hi·ªáu ·ª©ng quay */
        .highlight { border-color: #ffc107; background: #fff9e6; transform: scale(1.05); box-shadow: 0 5px 15px rgba(255,193,7,0.3); }
        .winner-card { border-color: #28a745 !important; background: #e8f5e9 !important; transform: scale(1.1); box-shadow: 0 5px 20px rgba(40,167,69,0.4); }

        #result-msg { font-size: 1.8rem; font-weight: bold; margin: 20px 0; min-height: 40px; }
        .spin-btn { background: var(--primary); font-size: 1.2rem; width: 250px; height: 60px; border-radius: 30px; box-shadow: 0 4px 15px rgba(255,71,87,0.3); }
        
        .admin-box { margin-top: 50px; border-top: 1px solid #eee; padding-top: 15px; display: flex; justify-content: center; align-items: center; gap: 10px; font-size: 0.8rem; color: #999; }
        .status-badge { display: inline-block; padding: 5px 10px; border-radius: 5px; background: #eee; font-size: 0.7rem; }
    </style>
</head>
<body>

<div class="container">
    <h1>üéÅ V√íNG QUAY MAY M·∫ÆN üéÅ</h1>

    <div class="input-area">
        <input type="text" id="nameInput" placeholder="Nh·∫≠p t√™n ng∆∞·ªùi ch∆°i...">
        <button onclick="addUser()">TH√äM NG∆Ø·ªúI</button>
    </div>

    <div id="display-area">
        </div>

    <button id="spinBtn" class="spin-btn" onclick="startSpin()">B·∫ÆT ƒê·∫¶U QUAY</button>
    <div id="result-msg"></div>

    <div class="admin-box">
        Admin Setup: <input type="number" id="adminChoice" placeholder="V·ªã tr√≠ tr√∫ng (1, 2...)" style="width: 80px; padding: 5px;">
        <span id="winnerStatus" class="status-badge">Ph·∫ßn th∆∞·ªüng: C√≤n 1</span>
    </div>
</div>

<audio id="tickSound" src="https://www.soundjay.com/button/button-16.mp3"></audio>

<script>
    let users = [];
    let hasWinner = false; // Bi·∫øn ki·ªÉm tra ƒë√£ c√≥ ng∆∞·ªùi tr√∫ng ch∆∞a
    const avatars = [
        "https://cdn-icons-png.flaticon.com/512/4140/4140231.png",
        "https://cdn-icons-png.flaticon.com/512/4140/4140226.png",
        "https://cdn-icons-png.flaticon.com/512/4140/4140229.png",
        "https://cdn-icons-png.flaticon.com/512/4140/4140227.png",
        "https://cdn-icons-png.flaticon.com/512/4140/4140228.png",
        "https://cdn-icons-png.flaticon.com/512/4140/4140230.png"
    ];

    function addUser() {
        const input = document.getElementById('nameInput');
        if (input.value.trim()) {
            const avatarIdx = Math.floor(Math.random() * avatars.length);
            users.push({ name: input.value.trim(), img: avatars[avatarIdx] });
            input.value = '';
            render();
        }
    }

    function render() {
        const area = document.getElementById('display-area');
        area.innerHTML = users.map((u, i) => `
            <div class="user-card" id="user-${i}">
                <img src="${u.img}" class="avatar">
                <div class="user-name">${u.name}</div>
            </div>
        `).join('');
    }

    function startSpin() {
        if (users.length < 1) return alert("Vui l√≤ng th√™m ng∆∞·ªùi ch∆°i!");
        
        const btn = document.getElementById('spinBtn');
        const res = document.getElementById('result-msg');
        btn.disabled = true;
        res.innerText = "‚è≥ ƒêang quay...";
        res.style.color = "#333";

        let current = 0;
        let steps = 0;
        const totalSteps = 30 + Math.floor(Math.random() * 10);
        const tick = document.getElementById('tickSound');

        const interval = setInterval(() => {
            document.querySelectorAll('.user-card').forEach(el => el.classList.remove('highlight'));
            document.getElementById(`user-${current}`).classList.add('highlight');
            
            tick.currentTime = 0;
            tick.play();

            current = (current + 1) % users.length;
            steps++;

            if (steps >= totalSteps) {
                clearInterval(interval);
                finishSpin();
            }
        }, 100);
    }

    function finishSpin() {
        const adminIndex = parseInt(document.getElementById('adminChoice').value) - 1;
        const btn = document.getElementById('spinBtn');
        const res = document.getElementById('result-msg');
        const status = document.getElementById('winnerStatus');

        document.querySelectorAll('.user-card').forEach(el => el.classList.remove('highlight'));
        
        // Lu√¥n d·ª´ng ·ªü v·ªã tr√≠ admin ch·ªçn (n·∫øu c√≥), n·∫øu kh√¥ng th√¨ ng·∫´u nhi√™n
        const finalIdx = (!isNaN(adminIndex) && adminIndex >= 0 && adminIndex < users.length) 
                        ? adminIndex : Math.floor(Math.random() * users.length);
        
        const winnerEl = document.getElementById(`user-${finalIdx}`);
        
        // KI·ªÇM TRA: Ch·ªâ cho ng∆∞·ªùi ƒë·∫ßu ti√™n tr√∫ng
        if (!hasWinner && finalIdx === adminIndex) {
            winnerEl.classList.add('winner-card');
            res.innerHTML = `<span style="color: #28a745">üéâ CH√öC M·ª™NG: ${users[finalIdx].name}!</span>`;
            status.innerText = "Ph·∫ßn th∆∞·ªüng: H·∫æT";
            status.style.background = "#ff4757";
            status.style.color = "white";
            hasWinner = true; // ƒê√°nh d·∫•u ƒë√£ c√≥ ng∆∞·ªùi nhanh nh·∫•t
            
            // Hi·ªáu ·ª©ng ph√°o hoa hoa gi·∫•y
            confetti({
                particleCount: 150,
                spread: 70,
                origin: { y: 0.6 },
                colors: ['#ff4757', '#ffc107', '#28a745', '#007bff']
            });
        } else {
            res.innerHTML = `<span style="color: #999">üíî May m·∫Øn l·∫ßn sau!</span>`;
        }

        btn.disabled = false;
    }
</script>

</body>
</html>
